# Управление контроллером SMC02 (шаговый двигатель)

## Краткое описание кнопок контроллера SMC02

![415_SMC02_FrontPanel.jpg](img/415_SMC02_FrontPanel.jpg)

- **Верхняя строка** — текущая скорость вращения (об/мин).
- **Нижняя строка** — пауза между циклами или количество выполненных циклов 
- **CW / CCW** — запуск вращения по часовой / против часовой стрелки.
- **RUN/STOP** — кнопка запуска и остановки.
- **Поворот ручки** — изменение скорости.
- **Удерживайте  ручки 3 секунды** — вход в меню настроек.

### Режим настройки параметров

1. Поверните ручку для выбора параметра.
2. Нажмите на ручку для перехода к редактированию.
3. Редактируйте значение одним из способов:
   - Поворот ручки целиком.
   - Разрядно: повторно нажмите — цифра заморгает.
4. Нажмите `RUN/STOP` для выхода.
5. Чтобы выйти из режима — удерживайте ручку 3 секунды.

Контроллер предоставляет гибкую настройку через параметры `F-01`–`F-13`.
По структуре это напоминает пользовательское меню бытового устройства, 
где каждый пункт настраивает отдельную функцию. За каждым пунктом стоит определённая 
функция — только вместо "полоскание" и "отжим" здесь `F-02`, `F-03` и т.д.



### Быстрая настройка

Настройку контроллера произведите на следующем этапе.

#### Вариант A — с прямым отображением оборотов бачка

Значение на дисплее = обороты бачка в минуту  
(напр., `3` означает `3 об/мин`)

| Параметр | Ring 38 мм         | O-Ring 40 мм        |
|----------|--------------------|---------------------|
| F-01     | P06                | P06                 |
| F-02     | 43430 (3430 H004)  | 41766 (1766 H004)   |
| F-03     | 9                  | 9                   |
| F-04     | 36751 (6751 H003)  | 35345 (5345 H003)   |
| F-05     | 9                  | 9                   |
| F-06     | 9999               | 9999                |
| F-07     | 0.5                | 0.5                 |
| F-08     | 0.5                | 0.5                 |
| F-09     | 1670               | 1604                |
| F-10     | 0                  | 0                   |
| F-11     | 0                  | 0                   |
| F-12     | 30                 | 30                  |

#### Вариант B — с ускоренным вводом скорости

В этом режиме:
- `3` = `9 об/мин`
- `4` = `12 об/мин`
- `5` = `15 об/мин`

| Параметр | Ring 38 мм         | O-Ring 40 мм        |
|----------|--------------------|---------------------|
| F-01     | P06                | P06                 |
| F-02     | 43430 (3430 H004)  | 41766 (1766 H004)   |
| F-03     | 3                  | 3                   |
| F-04     | 36751 (6751 H003)  | 35345 (5345 H003)   |
| F-05     | 3                  | 3                   |
| F-06     | 9999               | 9999                |
| F-07     | 0.5                | 0.5                 |
| F-08     | 0.5                | 0.5                 |
| **F-09** | 5011               | 4819                |
| F-10     | 0                  | 0                   |
| F-11     | 0                  | 0                   |
| F-12     | 30                 | 30                  |

### Заметки для тех, кто впервые работает с шаговыми двигателями

Уважаемые специалисты и опытные электронщики — приносим извинения за базовые 
пояснения в этом разделе. Для профессионалов эти сведения очевидны, но мы 
стремимся сделать руководство доступным для всех, включая начинающих фотографов, 
впервые сталкивающихся с электромеханикой.

Если вы только знакомитесь с шаговыми двигателями, важно понять их ключевое 
отличие от обычных электромоторов. Шаговый двигатель при подаче питания **не 
вращается непрерывно**, а поворачивается **на фиксированный угол** — именно 
поэтому он и называется "шаговым". Чтобы двигатель вращался плавнее, применяют 
технологию **микрошага**, при которой каждый базовый шаг разбивается на 
несколько мелких.

Для полного оборота вала (360°) нашему двигателю необходимо подать 
**6400 импульсов** — это при микрошаговом режиме делителя 32 и базовом угле 
шага 1,8°. Нам не требуется углубляться в технические детали — достаточно 
принять это как данность.

Наша задача — **настроить контроллер** таким образом, чтобы двигатель выполнял 
необходимое количество шагов, с нужной скоростью, в заданном направлении и 
останавливался в нужный момент.

## Подробности — для желающих разобраться

Рассмотрены параметры и даны формулы для их расчетов, описана логика дрифта при смене
вращения.

### Описание параметров контроллера

| Параметр | Назначение                                                 | Диапазон         | По умолчанию |
|----------|------------------------------------------------------------|------------------|--------------|
| F-01     | Режим работы                                               | P01 ~ P09        | P01          |
| F-02     | Шаги при вращении вперёд                                   | 1 ~ 9 999 999    | 1600         |
| F-03     | Скорость вперёд (об/мин)                                   | 0.1 ~ 999.9      | 10           |
| F-04     | Шаги при вращении назад                                    | 1 ~ 9 999 999    | 1600         |
| F-05     | Скорость назад (об/мин)                                    | 0.1 ~ 999.9      | 10           |
| F-06     | Количество повторений цикла                                | 0 ~ 9999 или ∞   | 1            |
| F-07     | Пауза после вращения вперёд (сек)                          | 0.0 ~ 999.9      | 0.0          |
| F-08     | Пауза после вращения назад (сек)                           | 0.0 ~ 999.9      | 0.0          |
| F-09     | Шагов на 1 оборот (единица = 10 шагов)                     | 1 ~ 9999         | 160          |
| F-10     | Режим дисплея (0 — задержка, 1 — количество циклов)        | 0 или 1          | 0            |
| F-11     | Способ остановки двигателя (0 — плавно, 1 — резко)         | 0 или 1          | 0            |
| F-12     | Ускорение/замедление (001 — плавно, 100 — резко)           | 001 ~ 100        | 020          |
| F-13     | Адрес устройства (для связи по UART)                       | 001 ~ 255        | 001          |

### Расчёт параметра F-09

Чтобы контроллер знал, сколько шагов соответствует одному обороту **бачка**,
учитывается обратное передаточное число от мотора к бачку. Т.е. число
оборотов, которое должно проделать ведущее колесо, чтобы повернуть проявочный 
бачок на один оборот.

#### Формулы:

$$
I_{\text{обратное}} = \frac{D_2}{D_1}
$$

$$
F\text{-}09 = \frac{I_{\text{обратное}} \times 6400}{10}
$$

где:

- \( D_1 \) — диаметр ведущего колеса
- \( D_2 \) — диаметр проявочного бачка
- \( 6400 \) — шагов на оборот вала двигателя
- Деление на 10 — поскольку `F-09` задаётся в десятках шагов

**Примеры:**

| Модель O-Ring   | Диаметр колеса | Передаточное | F-09 (точный) | Ускоренный |
|-----------------|----------------|--------------|---------------|------------|
| 38 мм (CS 3.1)  | 38.8 мм        | 2.61         | 1670          | 5011       |
| 40 мм (CS 4.0)  | 40.3 мм        | 2.51         | 1604          | 4819       |

#### Агитация и дрифт

Когда бачок каждый раз останавливается в одной и той же точке, возникает риск 
локального переэкспонирования плёнки. Чтобы этого избежать, мы добавляем 
**сдвиг остановок** — дрифт. Угол дрифта выбран 1/5 оборота проявочного бачка 
потому что 1/5 это наименьшее деление круга, при котором смена вращения не будет
происходить в соседних секторах, это разумный компромисс между «слишком мелко» 
и «слишком резко». 

Дополнительно, чтобы точки остановки **никогда не совпадали**, 
используется **простое число** — это предотвращает слишком частое 
периодическое совпадение остановок.

## Формулы агитации

Для вращения по часовой стрелке:  
\( 2.6 \times \frac{6400 \times I}{1} = F\text{-}02 \)

Для вращения против часовой стрелки:  
\( 2.0 \times \frac{6400 \times I}{1} + \text{простое число} = F\text{-}04 \)

Простое число выбирается как ближайшее к числу шагов, необходимому для поворота 
проявочного бачка на 1/5 оборота.

## Заключение

В реальности наша система не идеальна: шаговые двигатели иногда пропускают шаги, 
резиновые кольца меняют размер под нагрузкой, а расчеты округлены. Однако именно 
в этом сочетании инженерной точности и практического подхода проявляется характер 
проекта. 










